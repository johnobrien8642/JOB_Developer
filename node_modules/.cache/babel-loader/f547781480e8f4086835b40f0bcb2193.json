{"ast":null,"code":"\"use strict\";\n\nvar _createClass = require(\"/Users/johnobrien/Desktop/Rumblr_PROD/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar _inherits = require(\"/Users/johnobrien/Desktop/Rumblr_PROD/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/inherits\");\n\nvar _createSuper = require(\"/Users/johnobrien/Desktop/Rumblr_PROD/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createSuper\");\n\nvar _classCallCheck = require(\"/Users/johnobrien/Desktop/Rumblr_PROD/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ChapterText = exports.StcoAtom = exports.StszAtom = exports.StscAtom = exports.SampleToChunkToken = exports.SttsAtom = exports.TimeToSampleToken = exports.SoundSampleDescriptionV0 = exports.SoundSampleDescriptionVersion = exports.StsdAtom = exports.TrackHeaderAtom = exports.NameAtom = exports.DataAtom = exports.MvhdAtom = exports.MdhdAtom = exports.FixedLengthAtom = exports.mhdr = exports.tkhd = exports.ftyp = exports.ExtendedSize = exports.Header = void 0;\n\nvar Token = require(\"token-types\");\n\nvar FourCC_1 = require(\"../common/FourCC\");\n\nvar initDebug = require(\"debug\");\n\nvar debug = initDebug('music-metadata:parser:MP4:atom');\nexports.Header = {\n  len: 8,\n  get: function get(buf, off) {\n    var length = Token.UINT32_BE.get(buf, off);\n    if (length < 0) throw new Error('Invalid atom header length');\n    return {\n      length: length,\n      name: new Token.StringType(4, 'binary').get(buf, off + 4)\n    };\n  },\n  put: function put(buf, off, hdr) {\n    Token.UINT32_BE.put(buf, off, hdr.length);\n    return FourCC_1.FourCcToken.put(buf, off + 4, hdr.name);\n  }\n};\n/**\r\n * Ref: https://developer.apple.com/library/archive/documentation/QuickTime/QTFF/QTFFChap1/qtff1.html#//apple_ref/doc/uid/TP40000939-CH203-38190\r\n */\n\nexports.ExtendedSize = Token.UINT64_BE;\nexports.ftyp = {\n  len: 4,\n  get: function get(buf, off) {\n    return {\n      type: new Token.StringType(4, 'ascii').get(buf, off)\n    };\n  }\n};\nexports.tkhd = {\n  len: 4,\n  get: function get(buf, off) {\n    return {\n      type: new Token.StringType(4, 'ascii').get(buf, off)\n    };\n  }\n};\n/**\r\n * Token: Movie Header Atom\r\n */\n\nexports.mhdr = {\n  len: 8,\n  get: function get(buf, off) {\n    return {\n      version: Token.UINT8.get(buf, off + 0),\n      flags: Token.UINT24_BE.get(buf, off + 1),\n      nextItemID: Token.UINT32_BE.get(buf, off + 4)\n    };\n  }\n};\n/**\r\n * Base class for 'fixed' length atoms.\r\n * In some cases these atoms are longer then the sum of the described fields.\r\n * Issue: https://github.com/Borewit/music-metadata/issues/120\r\n */\n\nvar FixedLengthAtom =\n/**\r\n *\r\n * @param {number} len Length as specified in the size field\r\n * @param {number} expLen Total length of sum of specified fields in the standard\r\n */\nfunction FixedLengthAtom(len, expLen, atomId) {\n  _classCallCheck(this, FixedLengthAtom);\n\n  this.len = len;\n\n  if (len < expLen) {\n    throw new Error(\"Atom \".concat(atomId, \" expected to be \").concat(expLen, \", but specifies \").concat(len, \" bytes long.\"));\n  } else if (len > expLen) {\n    debug(\"Warning: atom \".concat(atomId, \" expected to be \").concat(expLen, \", but was actually \").concat(len, \" bytes long.\"));\n  }\n};\n\nexports.FixedLengthAtom = FixedLengthAtom;\n/**\r\n * Timestamp stored in seconds since Mac Epoch (1 January 1904)\r\n */\n\nvar SecondsSinceMacEpoch = {\n  len: 4,\n  get: function get(buf, off) {\n    var secondsSinceUnixEpoch = Token.UINT32_BE.get(buf, off) - 2082844800;\n    return new Date(secondsSinceUnixEpoch * 1000);\n  }\n};\n/**\r\n * Token: Media Header Atom\r\n * Ref:\r\n *   https://developer.apple.com/library/archive/documentation/QuickTime/QTFF/QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-SW34\r\n *   https://wiki.multimedia.cx/index.php/QuickTime_container#mdhd\r\n */\n\nvar MdhdAtom = /*#__PURE__*/function (_FixedLengthAtom) {\n  _inherits(MdhdAtom, _FixedLengthAtom);\n\n  var _super = _createSuper(MdhdAtom);\n\n  function MdhdAtom(len) {\n    var _this;\n\n    _classCallCheck(this, MdhdAtom);\n\n    _this = _super.call(this, len, 24, 'mdhd');\n    _this.len = len;\n    return _this;\n  }\n\n  _createClass(MdhdAtom, [{\n    key: \"get\",\n    value: function get(buf, off) {\n      return {\n        version: Token.UINT8.get(buf, off + 0),\n        flags: Token.UINT24_BE.get(buf, off + 1),\n        creationTime: SecondsSinceMacEpoch.get(buf, off + 4),\n        modificationTime: SecondsSinceMacEpoch.get(buf, off + 8),\n        timeScale: Token.UINT32_BE.get(buf, off + 12),\n        duration: Token.UINT32_BE.get(buf, off + 16),\n        language: Token.UINT16_BE.get(buf, off + 20),\n        quality: Token.UINT16_BE.get(buf, off + 22)\n      };\n    }\n  }]);\n\n  return MdhdAtom;\n}(FixedLengthAtom);\n\nexports.MdhdAtom = MdhdAtom;\n/**\r\n * Token: Movie Header Atom\r\n */\n\nvar MvhdAtom = /*#__PURE__*/function (_FixedLengthAtom2) {\n  _inherits(MvhdAtom, _FixedLengthAtom2);\n\n  var _super2 = _createSuper(MvhdAtom);\n\n  function MvhdAtom(len) {\n    var _this2;\n\n    _classCallCheck(this, MvhdAtom);\n\n    _this2 = _super2.call(this, len, 100, 'mvhd');\n    _this2.len = len;\n    return _this2;\n  }\n\n  _createClass(MvhdAtom, [{\n    key: \"get\",\n    value: function get(buf, off) {\n      return {\n        version: Token.UINT8.get(buf, off),\n        flags: Token.UINT24_BE.get(buf, off + 1),\n        creationTime: SecondsSinceMacEpoch.get(buf, off + 4),\n        modificationTime: SecondsSinceMacEpoch.get(buf, off + 8),\n        timeScale: Token.UINT32_BE.get(buf, off + 12),\n        duration: Token.UINT32_BE.get(buf, off + 16),\n        preferredRate: Token.UINT32_BE.get(buf, off + 20),\n        preferredVolume: Token.UINT16_BE.get(buf, off + 24),\n        // ignore reserver: 10 bytes\n        // ignore matrix structure: 36 bytes\n        previewTime: Token.UINT32_BE.get(buf, off + 72),\n        previewDuration: Token.UINT32_BE.get(buf, off + 76),\n        posterTime: Token.UINT32_BE.get(buf, off + 80),\n        selectionTime: Token.UINT32_BE.get(buf, off + 84),\n        selectionDuration: Token.UINT32_BE.get(buf, off + 88),\n        currentTime: Token.UINT32_BE.get(buf, off + 92),\n        nextTrackID: Token.UINT32_BE.get(buf, off + 96)\n      };\n    }\n  }]);\n\n  return MvhdAtom;\n}(FixedLengthAtom);\n\nexports.MvhdAtom = MvhdAtom;\n/**\r\n * Data Atom Structure\r\n */\n\nvar DataAtom = /*#__PURE__*/function () {\n  function DataAtom(len) {\n    _classCallCheck(this, DataAtom);\n\n    this.len = len;\n  }\n\n  _createClass(DataAtom, [{\n    key: \"get\",\n    value: function get(buf, off) {\n      return {\n        type: {\n          set: Token.UINT8.get(buf, off + 0),\n          type: Token.UINT24_BE.get(buf, off + 1)\n        },\n        locale: Token.UINT24_BE.get(buf, off + 4),\n        value: new Token.BufferType(this.len - 8).get(buf, off + 8)\n      };\n    }\n  }]);\n\n  return DataAtom;\n}();\n\nexports.DataAtom = DataAtom;\n/**\r\n * Data Atom Structure\r\n * Ref: https://developer.apple.com/library/content/documentation/QuickTime/QTFF/Metadata/Metadata.html#//apple_ref/doc/uid/TP40000939-CH1-SW31\r\n */\n\nvar NameAtom = /*#__PURE__*/function () {\n  function NameAtom(len) {\n    _classCallCheck(this, NameAtom);\n\n    this.len = len;\n  }\n\n  _createClass(NameAtom, [{\n    key: \"get\",\n    value: function get(buf, off) {\n      return {\n        version: Token.UINT8.get(buf, off),\n        flags: Token.UINT24_BE.get(buf, off + 1),\n        name: new Token.StringType(this.len - 4, 'utf-8').get(buf, off + 4)\n      };\n    }\n  }]);\n\n  return NameAtom;\n}();\n\nexports.NameAtom = NameAtom;\n/**\r\n * Track Header Atoms structure\r\n * Ref: https://developer.apple.com/library/content/documentation/QuickTime/QTFF/QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-25550\r\n */\n\nvar TrackHeaderAtom = /*#__PURE__*/function () {\n  function TrackHeaderAtom(len) {\n    _classCallCheck(this, TrackHeaderAtom);\n\n    this.len = len;\n  }\n\n  _createClass(TrackHeaderAtom, [{\n    key: \"get\",\n    value: function get(buf, off) {\n      return {\n        version: Token.UINT8.get(buf, off),\n        flags: Token.UINT24_BE.get(buf, off + 1),\n        creationTime: SecondsSinceMacEpoch.get(buf, off + 4),\n        modificationTime: SecondsSinceMacEpoch.get(buf, off + 8),\n        trackId: Token.UINT32_BE.get(buf, off + 12),\n        // reserved 4 bytes\n        duration: Token.UINT32_BE.get(buf, off + 20),\n        layer: Token.UINT16_BE.get(buf, off + 24),\n        alternateGroup: Token.UINT16_BE.get(buf, off + 26),\n        volume: Token.UINT16_BE.get(buf, off + 28) // ToDo: fixed point\n        // ToDo: add remaining fields\n\n      };\n    }\n  }]);\n\n  return TrackHeaderAtom;\n}();\n\nexports.TrackHeaderAtom = TrackHeaderAtom;\n/**\r\n * Atom: Sample Description Atom ('stsd')\r\n * Ref: https://developer.apple.com/library/archive/documentation/QuickTime/QTFF/QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-25691\r\n */\n\nvar stsdHeader = {\n  len: 8,\n  get: function get(buf, off) {\n    return {\n      version: Token.UINT8.get(buf, off),\n      flags: Token.UINT24_BE.get(buf, off + 1),\n      numberOfEntries: Token.UINT32_BE.get(buf, off + 4)\n    };\n  }\n};\n/**\r\n * Atom: Sample Description Atom ('stsd')\r\n * Ref: https://developer.apple.com/library/archive/documentation/QuickTime/QTFF/QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-25691\r\n */\n\nvar SampleDescriptionTable = /*#__PURE__*/function () {\n  function SampleDescriptionTable(len) {\n    _classCallCheck(this, SampleDescriptionTable);\n\n    this.len = len;\n  }\n\n  _createClass(SampleDescriptionTable, [{\n    key: \"get\",\n    value: function get(buf, off) {\n      return {\n        dataFormat: FourCC_1.FourCcToken.get(buf, off),\n        dataReferenceIndex: Token.UINT16_BE.get(buf, off + 10),\n        description: new Token.BufferType(this.len - 12).get(buf, off + 12)\n      };\n    }\n  }]);\n\n  return SampleDescriptionTable;\n}();\n/**\r\n * Atom: Sample-description Atom ('stsd')\r\n * Ref: https://developer.apple.com/library/archive/documentation/QuickTime/QTFF/QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-25691\r\n */\n\n\nvar StsdAtom = /*#__PURE__*/function () {\n  function StsdAtom(len) {\n    _classCallCheck(this, StsdAtom);\n\n    this.len = len;\n  }\n\n  _createClass(StsdAtom, [{\n    key: \"get\",\n    value: function get(buf, off) {\n      var header = stsdHeader.get(buf, off);\n      off += stsdHeader.len;\n      var table = [];\n\n      for (var n = 0; n < header.numberOfEntries; ++n) {\n        var size = Token.UINT32_BE.get(buf, off); // Sample description size\n\n        off += Token.UINT32_BE.len;\n        table.push(new SampleDescriptionTable(size).get(buf, off));\n        off += size;\n      }\n\n      return {\n        header: header,\n        table: table\n      };\n    }\n  }]);\n\n  return StsdAtom;\n}();\n\nexports.StsdAtom = StsdAtom;\n/**\r\n * Common Sound Sample Description (version & revision)\r\n * Ref: https://developer.apple.com/library/archive/documentation/QuickTime/QTFF/QTFFChap3/qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-57317\r\n */\n\nexports.SoundSampleDescriptionVersion = {\n  len: 8,\n  get: function get(buf, off) {\n    return {\n      version: Token.INT16_BE.get(buf, off),\n      revision: Token.INT16_BE.get(buf, off + 2),\n      vendor: Token.INT32_BE.get(buf, off + 4)\n    };\n  }\n};\n/**\r\n * Sound Sample Description (Version 0)\r\n * Ref: https://developer.apple.com/library/archive/documentation/QuickTime/QTFF/QTFFChap3/qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-130736\r\n */\n\nexports.SoundSampleDescriptionV0 = {\n  len: 12,\n  get: function get(buf, off) {\n    return {\n      numAudioChannels: Token.INT16_BE.get(buf, off + 0),\n      sampleSize: Token.INT16_BE.get(buf, off + 2),\n      compressionId: Token.INT16_BE.get(buf, off + 4),\n      packetSize: Token.INT16_BE.get(buf, off + 6),\n      sampleRate: Token.UINT16_BE.get(buf, off + 8) + Token.UINT16_BE.get(buf, off + 10) / 10000\n    };\n  }\n};\n\nvar SimpleTableAtom = /*#__PURE__*/function () {\n  function SimpleTableAtom(len, token) {\n    _classCallCheck(this, SimpleTableAtom);\n\n    this.len = len;\n    this.token = token;\n  }\n\n  _createClass(SimpleTableAtom, [{\n    key: \"get\",\n    value: function get(buf, off) {\n      var nrOfEntries = Token.INT32_BE.get(buf, off + 4);\n      return {\n        version: Token.INT8.get(buf, off + 0),\n        flags: Token.INT24_BE.get(buf, off + 1),\n        numberOfEntries: nrOfEntries,\n        entries: readTokenTable(buf, this.token, off + 8, this.len - 8, nrOfEntries)\n      };\n    }\n  }]);\n\n  return SimpleTableAtom;\n}();\n\nexports.TimeToSampleToken = {\n  len: 8,\n  get: function get(buf, off) {\n    return {\n      count: Token.INT32_BE.get(buf, off + 0),\n      duration: Token.INT32_BE.get(buf, off + 4)\n    };\n  }\n};\n/**\r\n * Time-to-sample('stts') atom.\r\n * Store duration information for a media’s samples.\r\n * Ref: https://developer.apple.com/library/archive/documentation/QuickTime/QTFF/QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-25696\r\n */\n\nvar SttsAtom = /*#__PURE__*/function (_SimpleTableAtom) {\n  _inherits(SttsAtom, _SimpleTableAtom);\n\n  var _super3 = _createSuper(SttsAtom);\n\n  function SttsAtom(len) {\n    var _this3;\n\n    _classCallCheck(this, SttsAtom);\n\n    _this3 = _super3.call(this, len, exports.TimeToSampleToken);\n    _this3.len = len;\n    return _this3;\n  }\n\n  return SttsAtom;\n}(SimpleTableAtom);\n\nexports.SttsAtom = SttsAtom;\nexports.SampleToChunkToken = {\n  len: 12,\n  get: function get(buf, off) {\n    return {\n      firstChunk: Token.INT32_BE.get(buf, off),\n      samplesPerChunk: Token.INT32_BE.get(buf, off + 4),\n      sampleDescriptionId: Token.INT32_BE.get(buf, off + 8)\n    };\n  }\n};\n/**\r\n * Sample-to-Chunk ('stsc') atom interface\r\n * Ref: https://developer.apple.com/library/archive/documentation/QuickTime/QTFF/QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-25706\r\n */\n\nvar StscAtom = /*#__PURE__*/function (_SimpleTableAtom2) {\n  _inherits(StscAtom, _SimpleTableAtom2);\n\n  var _super4 = _createSuper(StscAtom);\n\n  function StscAtom(len) {\n    var _this4;\n\n    _classCallCheck(this, StscAtom);\n\n    _this4 = _super4.call(this, len, exports.SampleToChunkToken);\n    _this4.len = len;\n    return _this4;\n  }\n\n  return StscAtom;\n}(SimpleTableAtom);\n\nexports.StscAtom = StscAtom;\n/**\r\n * Sample-size ('stsz') atom\r\n * Ref: https://developer.apple.com/library/archive/documentation/QuickTime/QTFF/QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-25710\r\n */\n\nvar StszAtom = /*#__PURE__*/function () {\n  function StszAtom(len) {\n    _classCallCheck(this, StszAtom);\n\n    this.len = len;\n  }\n\n  _createClass(StszAtom, [{\n    key: \"get\",\n    value: function get(buf, off) {\n      var nrOfEntries = Token.INT32_BE.get(buf, off + 8);\n      return {\n        version: Token.INT8.get(buf, off),\n        flags: Token.INT24_BE.get(buf, off + 1),\n        sampleSize: Token.INT32_BE.get(buf, off + 4),\n        numberOfEntries: nrOfEntries,\n        entries: readTokenTable(buf, Token.INT32_BE, off + 12, this.len - 12, nrOfEntries)\n      };\n    }\n  }]);\n\n  return StszAtom;\n}();\n\nexports.StszAtom = StszAtom;\n/**\r\n * Chunk offset atom, 'stco'\r\n * Ref: https://developer.apple.com/library/archive/documentation/QuickTime/QTFF/QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-25715\r\n */\n\nvar StcoAtom = /*#__PURE__*/function (_SimpleTableAtom3) {\n  _inherits(StcoAtom, _SimpleTableAtom3);\n\n  var _super5 = _createSuper(StcoAtom);\n\n  function StcoAtom(len) {\n    var _this5;\n\n    _classCallCheck(this, StcoAtom);\n\n    _this5 = _super5.call(this, len, Token.INT32_BE);\n    _this5.len = len;\n    return _this5;\n  }\n\n  return StcoAtom;\n}(SimpleTableAtom);\n\nexports.StcoAtom = StcoAtom;\n/**\r\n * Token used to decode text-track from 'mdat' atom (raw data stream)\r\n */\n\nvar ChapterText = /*#__PURE__*/function () {\n  function ChapterText(len) {\n    _classCallCheck(this, ChapterText);\n\n    this.len = len;\n  }\n\n  _createClass(ChapterText, [{\n    key: \"get\",\n    value: function get(buf, off) {\n      var titleLen = Token.INT16_BE.get(buf, off + 0);\n      var str = new Token.StringType(titleLen, 'utf-8');\n      return str.get(buf, off + 2);\n    }\n  }]);\n\n  return ChapterText;\n}();\n\nexports.ChapterText = ChapterText;\n\nfunction readTokenTable(buf, token, off, remainingLen, numberOfEntries) {\n  debug(\"remainingLen=\".concat(remainingLen, \", numberOfEntries=\").concat(numberOfEntries, \" * token-len=\").concat(token.len));\n  if (remainingLen === 0) return [];\n  if (remainingLen !== numberOfEntries * token.len) throw new Error('mismatch number-of-entries with remaining atom-length');\n  var entries = []; // parse offset-table\n\n  for (var n = 0; n < numberOfEntries; ++n) {\n    entries.push(token.get(buf, off));\n    off += token.len;\n  }\n\n  return entries;\n}","map":{"version":3,"sources":["/Users/johnobrien/Desktop/Rumblr_PROD/client/node_modules/music-metadata/lib/mp4/AtomToken.js"],"names":["Object","defineProperty","exports","value","ChapterText","StcoAtom","StszAtom","StscAtom","SampleToChunkToken","SttsAtom","TimeToSampleToken","SoundSampleDescriptionV0","SoundSampleDescriptionVersion","StsdAtom","TrackHeaderAtom","NameAtom","DataAtom","MvhdAtom","MdhdAtom","FixedLengthAtom","mhdr","tkhd","ftyp","ExtendedSize","Header","Token","require","FourCC_1","initDebug","debug","len","get","buf","off","length","UINT32_BE","Error","name","StringType","put","hdr","FourCcToken","UINT64_BE","type","version","UINT8","flags","UINT24_BE","nextItemID","expLen","atomId","SecondsSinceMacEpoch","secondsSinceUnixEpoch","Date","creationTime","modificationTime","timeScale","duration","language","UINT16_BE","quality","preferredRate","preferredVolume","previewTime","previewDuration","posterTime","selectionTime","selectionDuration","currentTime","nextTrackID","set","locale","BufferType","trackId","layer","alternateGroup","volume","stsdHeader","numberOfEntries","SampleDescriptionTable","dataFormat","dataReferenceIndex","description","header","table","n","size","push","INT16_BE","revision","vendor","INT32_BE","numAudioChannels","sampleSize","compressionId","packetSize","sampleRate","SimpleTableAtom","token","nrOfEntries","INT8","INT24_BE","entries","readTokenTable","count","firstChunk","samplesPerChunk","sampleDescriptionId","titleLen","str","remainingLen"],"mappings":"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","sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.ChapterText = exports.StcoAtom = exports.StszAtom = exports.StscAtom = exports.SampleToChunkToken = exports.SttsAtom = exports.TimeToSampleToken = exports.SoundSampleDescriptionV0 = exports.SoundSampleDescriptionVersion = exports.StsdAtom = exports.TrackHeaderAtom = exports.NameAtom = exports.DataAtom = exports.MvhdAtom = exports.MdhdAtom = exports.FixedLengthAtom = exports.mhdr = exports.tkhd = exports.ftyp = exports.ExtendedSize = exports.Header = void 0;\r\nconst Token = require(\"token-types\");\r\nconst FourCC_1 = require(\"../common/FourCC\");\r\nconst initDebug = require(\"debug\");\r\nconst debug = initDebug('music-metadata:parser:MP4:atom');\r\nexports.Header = {\r\n    len: 8,\r\n    get: (buf, off) => {\r\n        const length = Token.UINT32_BE.get(buf, off);\r\n        if (length < 0)\r\n            throw new Error('Invalid atom header length');\r\n        return {\r\n            length,\r\n            name: new Token.StringType(4, 'binary').get(buf, off + 4)\r\n        };\r\n    },\r\n    put: (buf, off, hdr) => {\r\n        Token.UINT32_BE.put(buf, off, hdr.length);\r\n        return FourCC_1.FourCcToken.put(buf, off + 4, hdr.name);\r\n    }\r\n};\r\n/**\r\n * Ref: https://developer.apple.com/library/archive/documentation/QuickTime/QTFF/QTFFChap1/qtff1.html#//apple_ref/doc/uid/TP40000939-CH203-38190\r\n */\r\nexports.ExtendedSize = Token.UINT64_BE;\r\nexports.ftyp = {\r\n    len: 4,\r\n    get: (buf, off) => {\r\n        return {\r\n            type: new Token.StringType(4, 'ascii').get(buf, off)\r\n        };\r\n    }\r\n};\r\nexports.tkhd = {\r\n    len: 4,\r\n    get: (buf, off) => {\r\n        return {\r\n            type: new Token.StringType(4, 'ascii').get(buf, off)\r\n        };\r\n    }\r\n};\r\n/**\r\n * Token: Movie Header Atom\r\n */\r\nexports.mhdr = {\r\n    len: 8,\r\n    get: (buf, off) => {\r\n        return {\r\n            version: Token.UINT8.get(buf, off + 0),\r\n            flags: Token.UINT24_BE.get(buf, off + 1),\r\n            nextItemID: Token.UINT32_BE.get(buf, off + 4)\r\n        };\r\n    }\r\n};\r\n/**\r\n * Base class for 'fixed' length atoms.\r\n * In some cases these atoms are longer then the sum of the described fields.\r\n * Issue: https://github.com/Borewit/music-metadata/issues/120\r\n */\r\nclass FixedLengthAtom {\r\n    /**\r\n     *\r\n     * @param {number} len Length as specified in the size field\r\n     * @param {number} expLen Total length of sum of specified fields in the standard\r\n     */\r\n    constructor(len, expLen, atomId) {\r\n        this.len = len;\r\n        if (len < expLen) {\r\n            throw new Error(`Atom ${atomId} expected to be ${expLen}, but specifies ${len} bytes long.`);\r\n        }\r\n        else if (len > expLen) {\r\n            debug(`Warning: atom ${atomId} expected to be ${expLen}, but was actually ${len} bytes long.`);\r\n        }\r\n    }\r\n}\r\nexports.FixedLengthAtom = FixedLengthAtom;\r\n/**\r\n * Timestamp stored in seconds since Mac Epoch (1 January 1904)\r\n */\r\nconst SecondsSinceMacEpoch = {\r\n    len: 4,\r\n    get: (buf, off) => {\r\n        const secondsSinceUnixEpoch = Token.UINT32_BE.get(buf, off) - 2082844800;\r\n        return new Date(secondsSinceUnixEpoch * 1000);\r\n    }\r\n};\r\n/**\r\n * Token: Media Header Atom\r\n * Ref:\r\n *   https://developer.apple.com/library/archive/documentation/QuickTime/QTFF/QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-SW34\r\n *   https://wiki.multimedia.cx/index.php/QuickTime_container#mdhd\r\n */\r\nclass MdhdAtom extends FixedLengthAtom {\r\n    constructor(len) {\r\n        super(len, 24, 'mdhd');\r\n        this.len = len;\r\n    }\r\n    get(buf, off) {\r\n        return {\r\n            version: Token.UINT8.get(buf, off + 0),\r\n            flags: Token.UINT24_BE.get(buf, off + 1),\r\n            creationTime: SecondsSinceMacEpoch.get(buf, off + 4),\r\n            modificationTime: SecondsSinceMacEpoch.get(buf, off + 8),\r\n            timeScale: Token.UINT32_BE.get(buf, off + 12),\r\n            duration: Token.UINT32_BE.get(buf, off + 16),\r\n            language: Token.UINT16_BE.get(buf, off + 20),\r\n            quality: Token.UINT16_BE.get(buf, off + 22)\r\n        };\r\n    }\r\n}\r\nexports.MdhdAtom = MdhdAtom;\r\n/**\r\n * Token: Movie Header Atom\r\n */\r\nclass MvhdAtom extends FixedLengthAtom {\r\n    constructor(len) {\r\n        super(len, 100, 'mvhd');\r\n        this.len = len;\r\n    }\r\n    get(buf, off) {\r\n        return {\r\n            version: Token.UINT8.get(buf, off),\r\n            flags: Token.UINT24_BE.get(buf, off + 1),\r\n            creationTime: SecondsSinceMacEpoch.get(buf, off + 4),\r\n            modificationTime: SecondsSinceMacEpoch.get(buf, off + 8),\r\n            timeScale: Token.UINT32_BE.get(buf, off + 12),\r\n            duration: Token.UINT32_BE.get(buf, off + 16),\r\n            preferredRate: Token.UINT32_BE.get(buf, off + 20),\r\n            preferredVolume: Token.UINT16_BE.get(buf, off + 24),\r\n            // ignore reserver: 10 bytes\r\n            // ignore matrix structure: 36 bytes\r\n            previewTime: Token.UINT32_BE.get(buf, off + 72),\r\n            previewDuration: Token.UINT32_BE.get(buf, off + 76),\r\n            posterTime: Token.UINT32_BE.get(buf, off + 80),\r\n            selectionTime: Token.UINT32_BE.get(buf, off + 84),\r\n            selectionDuration: Token.UINT32_BE.get(buf, off + 88),\r\n            currentTime: Token.UINT32_BE.get(buf, off + 92),\r\n            nextTrackID: Token.UINT32_BE.get(buf, off + 96)\r\n        };\r\n    }\r\n}\r\nexports.MvhdAtom = MvhdAtom;\r\n/**\r\n * Data Atom Structure\r\n */\r\nclass DataAtom {\r\n    constructor(len) {\r\n        this.len = len;\r\n    }\r\n    get(buf, off) {\r\n        return {\r\n            type: {\r\n                set: Token.UINT8.get(buf, off + 0),\r\n                type: Token.UINT24_BE.get(buf, off + 1)\r\n            },\r\n            locale: Token.UINT24_BE.get(buf, off + 4),\r\n            value: new Token.BufferType(this.len - 8).get(buf, off + 8)\r\n        };\r\n    }\r\n}\r\nexports.DataAtom = DataAtom;\r\n/**\r\n * Data Atom Structure\r\n * Ref: https://developer.apple.com/library/content/documentation/QuickTime/QTFF/Metadata/Metadata.html#//apple_ref/doc/uid/TP40000939-CH1-SW31\r\n */\r\nclass NameAtom {\r\n    constructor(len) {\r\n        this.len = len;\r\n    }\r\n    get(buf, off) {\r\n        return {\r\n            version: Token.UINT8.get(buf, off),\r\n            flags: Token.UINT24_BE.get(buf, off + 1),\r\n            name: new Token.StringType(this.len - 4, 'utf-8').get(buf, off + 4)\r\n        };\r\n    }\r\n}\r\nexports.NameAtom = NameAtom;\r\n/**\r\n * Track Header Atoms structure\r\n * Ref: https://developer.apple.com/library/content/documentation/QuickTime/QTFF/QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-25550\r\n */\r\nclass TrackHeaderAtom {\r\n    constructor(len) {\r\n        this.len = len;\r\n    }\r\n    get(buf, off) {\r\n        return {\r\n            version: Token.UINT8.get(buf, off),\r\n            flags: Token.UINT24_BE.get(buf, off + 1),\r\n            creationTime: SecondsSinceMacEpoch.get(buf, off + 4),\r\n            modificationTime: SecondsSinceMacEpoch.get(buf, off + 8),\r\n            trackId: Token.UINT32_BE.get(buf, off + 12),\r\n            // reserved 4 bytes\r\n            duration: Token.UINT32_BE.get(buf, off + 20),\r\n            layer: Token.UINT16_BE.get(buf, off + 24),\r\n            alternateGroup: Token.UINT16_BE.get(buf, off + 26),\r\n            volume: Token.UINT16_BE.get(buf, off + 28) // ToDo: fixed point\r\n            // ToDo: add remaining fields\r\n        };\r\n    }\r\n}\r\nexports.TrackHeaderAtom = TrackHeaderAtom;\r\n/**\r\n * Atom: Sample Description Atom ('stsd')\r\n * Ref: https://developer.apple.com/library/archive/documentation/QuickTime/QTFF/QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-25691\r\n */\r\nconst stsdHeader = {\r\n    len: 8,\r\n    get: (buf, off) => {\r\n        return {\r\n            version: Token.UINT8.get(buf, off),\r\n            flags: Token.UINT24_BE.get(buf, off + 1),\r\n            numberOfEntries: Token.UINT32_BE.get(buf, off + 4)\r\n        };\r\n    }\r\n};\r\n/**\r\n * Atom: Sample Description Atom ('stsd')\r\n * Ref: https://developer.apple.com/library/archive/documentation/QuickTime/QTFF/QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-25691\r\n */\r\nclass SampleDescriptionTable {\r\n    constructor(len) {\r\n        this.len = len;\r\n    }\r\n    get(buf, off) {\r\n        return {\r\n            dataFormat: FourCC_1.FourCcToken.get(buf, off),\r\n            dataReferenceIndex: Token.UINT16_BE.get(buf, off + 10),\r\n            description: new Token.BufferType(this.len - 12).get(buf, off + 12)\r\n        };\r\n    }\r\n}\r\n/**\r\n * Atom: Sample-description Atom ('stsd')\r\n * Ref: https://developer.apple.com/library/archive/documentation/QuickTime/QTFF/QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-25691\r\n */\r\nclass StsdAtom {\r\n    constructor(len) {\r\n        this.len = len;\r\n    }\r\n    get(buf, off) {\r\n        const header = stsdHeader.get(buf, off);\r\n        off += stsdHeader.len;\r\n        const table = [];\r\n        for (let n = 0; n < header.numberOfEntries; ++n) {\r\n            const size = Token.UINT32_BE.get(buf, off); // Sample description size\r\n            off += Token.UINT32_BE.len;\r\n            table.push(new SampleDescriptionTable(size).get(buf, off));\r\n            off += size;\r\n        }\r\n        return {\r\n            header,\r\n            table\r\n        };\r\n    }\r\n}\r\nexports.StsdAtom = StsdAtom;\r\n/**\r\n * Common Sound Sample Description (version & revision)\r\n * Ref: https://developer.apple.com/library/archive/documentation/QuickTime/QTFF/QTFFChap3/qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-57317\r\n */\r\nexports.SoundSampleDescriptionVersion = {\r\n    len: 8,\r\n    get(buf, off) {\r\n        return {\r\n            version: Token.INT16_BE.get(buf, off),\r\n            revision: Token.INT16_BE.get(buf, off + 2),\r\n            vendor: Token.INT32_BE.get(buf, off + 4)\r\n        };\r\n    }\r\n};\r\n/**\r\n * Sound Sample Description (Version 0)\r\n * Ref: https://developer.apple.com/library/archive/documentation/QuickTime/QTFF/QTFFChap3/qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-130736\r\n */\r\nexports.SoundSampleDescriptionV0 = {\r\n    len: 12,\r\n    get(buf, off) {\r\n        return {\r\n            numAudioChannels: Token.INT16_BE.get(buf, off + 0),\r\n            sampleSize: Token.INT16_BE.get(buf, off + 2),\r\n            compressionId: Token.INT16_BE.get(buf, off + 4),\r\n            packetSize: Token.INT16_BE.get(buf, off + 6),\r\n            sampleRate: Token.UINT16_BE.get(buf, off + 8) + Token.UINT16_BE.get(buf, off + 10) / 10000\r\n        };\r\n    }\r\n};\r\nclass SimpleTableAtom {\r\n    constructor(len, token) {\r\n        this.len = len;\r\n        this.token = token;\r\n    }\r\n    get(buf, off) {\r\n        const nrOfEntries = Token.INT32_BE.get(buf, off + 4);\r\n        return {\r\n            version: Token.INT8.get(buf, off + 0),\r\n            flags: Token.INT24_BE.get(buf, off + 1),\r\n            numberOfEntries: nrOfEntries,\r\n            entries: readTokenTable(buf, this.token, off + 8, this.len - 8, nrOfEntries)\r\n        };\r\n    }\r\n}\r\nexports.TimeToSampleToken = {\r\n    len: 8,\r\n    get(buf, off) {\r\n        return {\r\n            count: Token.INT32_BE.get(buf, off + 0),\r\n            duration: Token.INT32_BE.get(buf, off + 4)\r\n        };\r\n    }\r\n};\r\n/**\r\n * Time-to-sample('stts') atom.\r\n * Store duration information for a media’s samples.\r\n * Ref: https://developer.apple.com/library/archive/documentation/QuickTime/QTFF/QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-25696\r\n */\r\nclass SttsAtom extends SimpleTableAtom {\r\n    constructor(len) {\r\n        super(len, exports.TimeToSampleToken);\r\n        this.len = len;\r\n    }\r\n}\r\nexports.SttsAtom = SttsAtom;\r\nexports.SampleToChunkToken = {\r\n    len: 12,\r\n    get(buf, off) {\r\n        return {\r\n            firstChunk: Token.INT32_BE.get(buf, off),\r\n            samplesPerChunk: Token.INT32_BE.get(buf, off + 4),\r\n            sampleDescriptionId: Token.INT32_BE.get(buf, off + 8)\r\n        };\r\n    }\r\n};\r\n/**\r\n * Sample-to-Chunk ('stsc') atom interface\r\n * Ref: https://developer.apple.com/library/archive/documentation/QuickTime/QTFF/QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-25706\r\n */\r\nclass StscAtom extends SimpleTableAtom {\r\n    constructor(len) {\r\n        super(len, exports.SampleToChunkToken);\r\n        this.len = len;\r\n    }\r\n}\r\nexports.StscAtom = StscAtom;\r\n/**\r\n * Sample-size ('stsz') atom\r\n * Ref: https://developer.apple.com/library/archive/documentation/QuickTime/QTFF/QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-25710\r\n */\r\nclass StszAtom {\r\n    constructor(len) {\r\n        this.len = len;\r\n    }\r\n    get(buf, off) {\r\n        const nrOfEntries = Token.INT32_BE.get(buf, off + 8);\r\n        return {\r\n            version: Token.INT8.get(buf, off),\r\n            flags: Token.INT24_BE.get(buf, off + 1),\r\n            sampleSize: Token.INT32_BE.get(buf, off + 4),\r\n            numberOfEntries: nrOfEntries,\r\n            entries: readTokenTable(buf, Token.INT32_BE, off + 12, this.len - 12, nrOfEntries)\r\n        };\r\n    }\r\n}\r\nexports.StszAtom = StszAtom;\r\n/**\r\n * Chunk offset atom, 'stco'\r\n * Ref: https://developer.apple.com/library/archive/documentation/QuickTime/QTFF/QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-25715\r\n */\r\nclass StcoAtom extends SimpleTableAtom {\r\n    constructor(len) {\r\n        super(len, Token.INT32_BE);\r\n        this.len = len;\r\n    }\r\n}\r\nexports.StcoAtom = StcoAtom;\r\n/**\r\n * Token used to decode text-track from 'mdat' atom (raw data stream)\r\n */\r\nclass ChapterText {\r\n    constructor(len) {\r\n        this.len = len;\r\n    }\r\n    get(buf, off) {\r\n        const titleLen = Token.INT16_BE.get(buf, off + 0);\r\n        const str = new Token.StringType(titleLen, 'utf-8');\r\n        return str.get(buf, off + 2);\r\n    }\r\n}\r\nexports.ChapterText = ChapterText;\r\nfunction readTokenTable(buf, token, off, remainingLen, numberOfEntries) {\r\n    debug(`remainingLen=${remainingLen}, numberOfEntries=${numberOfEntries} * token-len=${token.len}`);\r\n    if (remainingLen === 0)\r\n        return [];\r\n    if (remainingLen !== numberOfEntries * token.len)\r\n        throw new Error('mismatch number-of-entries with remaining atom-length');\r\n    const entries = [];\r\n    // parse offset-table\r\n    for (let n = 0; n < numberOfEntries; ++n) {\r\n        entries.push(token.get(buf, off));\r\n        off += token.len;\r\n    }\r\n    return entries;\r\n}\r\n"]},"metadata":{},"sourceType":"script"}