{"ast":null,"code":"import React,{useEffect,useRef}from'react';import{useQuery,useApolloClient}from'@apollo/client';import{Link}from'react-router-dom';import PostUpdateOrShow from'../posts/types/showOrUpdate/PostUpdateOrShow';import Cookies from'js-cookie';import Queries from'../../graphql/queries';import FeedUtil from'../posts/util/functions/feed_util.js';import ProfilePic from'../user/util/components/Profile_Pic';import PostLoading from'../nav/Post_Loading';import FollowButton from'../posts/util/components/social/Follow_Button';import PostShowUtil from'../posts/util/functions/post_show_util.js';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var FETCH_USER_FEED=Queries.FETCH_USER_FEED,FETCH_TAG_FEED=Queries.FETCH_TAG_FEED,FETCH_USER_LIKES=Queries.FETCH_USER_LIKES;var infiniteScroll=FeedUtil.infiniteScroll,updateCacheInfScroll=FeedUtil.updateCacheInfScroll,handleData=FeedUtil.handleData,setgqlQueryAndQueryFeed=FeedUtil.setgqlQueryAndQueryFeed;var handlePostClassName=PostShowUtil.handlePostClassName;var Feed=function Feed(_ref){var user=_ref.user,tag=_ref.tag,userLikes=_ref.userLikes,currentUser=_ref.currentUser,uploading=_ref.uploading,setUploading=_ref.setUploading;var feedArr=useRef([]);var fetchMoreDiv=useRef(null);var fetchMoreDivId=useRef('#fetchMoreFeed');var cursorId=useRef(null);var query=useRef(Cookies.get('currentUser'));var gqlQuery=useRef(FETCH_USER_FEED);var endOfPosts=useRef(false);var client=useApolloClient();setgqlQueryAndQueryFeed(tag,user,userLikes,gqlQuery,query,FETCH_TAG_FEED,FETCH_USER_LIKES,Cookies.get('currentUser'));useEffect(function(){var scroll=infiniteScroll(client,updateCacheInfScroll,query,gqlQuery,cursorId,fetchMoreDiv,fetchMoreDivId);return function(){document.removeEventListener('scroll',scroll);};//eslint-disable-next-line\n},[]);var _useQuery=useQuery(gqlQuery.current,{variables:{query:query.current,cursorId:null}}),loading=_useQuery.loading,error=_useQuery.error,data=_useQuery.data;if(loading)return'';if(error)return\"Error: \".concat(error);handleData(data,feedArr,cursorId,endOfPosts);var handleLikesHeader=function handleLikesHeader(){if(userLikes){return/*#__PURE__*/_jsxs(\"div\",{className:\"userLikesHeader\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Likes\"}),/*#__PURE__*/_jsx(\"span\",{className:\"totalLikeCount\",children:\"\".concat(currentUser.totalLikeCount,\" likes\")})]});}};return/*#__PURE__*/_jsxs(\"div\",{className:\"userOrTagFeed\",children:[handleLikesHeader(),/*#__PURE__*/_jsx(PostLoading,{uploading:uploading}),feedArr.current.map(function(obj,i){if(obj.kind==='Repost'){return/*#__PURE__*/_jsxs(\"div\",{className:handlePostClassName(obj),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"userRepostShowHeader\",children:[/*#__PURE__*/_jsx(ProfilePic,{user:obj.post.user}),/*#__PURE__*/_jsxs(\"span\",{className:\"repostHeaderContainer\",children:[/*#__PURE__*/_jsx(Link,{className:\"user\",to:\"/view/blog/\".concat(obj.user.blogName),children:obj.user.blogName}),/*#__PURE__*/_jsxs(\"div\",{className:\"iconRepostedAndFollowContainer\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"https://img.icons8.com/material-two-tone/24/ffffff/retweet.png\",alt:\"\"}),/*#__PURE__*/_jsx(Link,{className:\"repostedFrom\",to:\"/view/blog/\".concat(obj.repostedFrom.blogName),children:obj.user.blogName}),/*#__PURE__*/_jsx(FollowButton,{feed:true,user:obj.repostedFrom})]})]})]}),/*#__PURE__*/_jsx(PostUpdateOrShow,{post:obj,repostFormBool:false,uploading:uploading,setUploading:setUploading})]},obj._id);}else{return/*#__PURE__*/_jsx(\"div\",{className:handlePostClassName(obj),children:/*#__PURE__*/_jsx(PostUpdateOrShow,{post:obj,currentUser:currentUser,uploading:uploading,setUploading:setUploading})},obj._id);}}),/*#__PURE__*/_jsx(\"div\",{id:\"fetchMoreFeed\",children:endOfPosts.current?\"You're all caught up\":\"\"})]});};export default Feed;","map":{"version":3,"sources":["/Users/johnobrien/Desktop/Rumblr_PROD/client/src/components/feeds/Feed.js"],"names":["React","useEffect","useRef","useQuery","useApolloClient","Link","PostUpdateOrShow","Cookies","Queries","FeedUtil","ProfilePic","PostLoading","FollowButton","PostShowUtil","FETCH_USER_FEED","FETCH_TAG_FEED","FETCH_USER_LIKES","infiniteScroll","updateCacheInfScroll","handleData","setgqlQueryAndQueryFeed","handlePostClassName","Feed","user","tag","userLikes","currentUser","uploading","setUploading","feedArr","fetchMoreDiv","fetchMoreDivId","cursorId","query","get","gqlQuery","endOfPosts","client","scroll","document","removeEventListener","current","variables","loading","error","data","handleLikesHeader","totalLikeCount","map","obj","i","kind","post","blogName","repostedFrom","_id"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef } from 'react';\nimport { useQuery, useApolloClient } from '@apollo/client';\nimport { Link } from 'react-router-dom';\nimport PostUpdateOrShow from '../posts/types/showOrUpdate/PostUpdateOrShow';\nimport Cookies from 'js-cookie';\nimport Queries from '../../graphql/queries';\nimport FeedUtil from '../posts/util/functions/feed_util.js';\nimport ProfilePic from '../user/util/components/Profile_Pic';\nimport PostLoading from '../nav/Post_Loading';\nimport FollowButton from '../posts/util/components/social/Follow_Button';\nimport PostShowUtil from '../posts/util/functions/post_show_util.js';\nconst { FETCH_USER_FEED, FETCH_TAG_FEED, FETCH_USER_LIKES } = Queries;\nconst { infiniteScroll, updateCacheInfScroll,\n        handleData, setgqlQueryAndQueryFeed } = FeedUtil;\nconst { handlePostClassName } = PostShowUtil;\n\nconst Feed = ({\n  user, \n  tag,\n  userLikes,\n  currentUser,\n  uploading,\n  setUploading\n}) => {\n  let feedArr = useRef([])\n  let fetchMoreDiv = useRef(null);\n  let fetchMoreDivId = useRef('#fetchMoreFeed');\n  let cursorId = useRef(null);\n  let query = useRef(Cookies.get('currentUser'))\n  let gqlQuery = useRef(FETCH_USER_FEED)\n  let endOfPosts = useRef(false)\n  const client = useApolloClient();\n\n  setgqlQueryAndQueryFeed(\n    tag, \n    user, \n    userLikes, \n    gqlQuery, \n    query, \n    FETCH_TAG_FEED,\n    FETCH_USER_LIKES,\n    Cookies.get('currentUser')\n  )\n  \n  useEffect(() => {\n    \n    var scroll = infiniteScroll(\n      client, updateCacheInfScroll,\n      query, gqlQuery,\n      cursorId, fetchMoreDiv,\n      fetchMoreDivId\n    )\n    \n    return () => {\n      document.removeEventListener('scroll', scroll)\n    }\n    //eslint-disable-next-line\n  }, [])\n  \n  let { loading, error, data } = useQuery(gqlQuery.current, {\n    variables: {\n      query: query.current,\n      cursorId: null\n    },\n  })\n\n  if (loading) return '';\n  if (error) return `Error: ${error}`;\n  \n  handleData(data, feedArr, cursorId, endOfPosts)\n\n  var handleLikesHeader = () => {\n    if (userLikes) {\n      return (\n        <div\n          className='userLikesHeader'\n        >\n          <h1>Likes</h1>\n          <span \n            className='totalLikeCount'\n          >\n            {`${currentUser.totalLikeCount} likes`}\n          </span>\n        </div>\n      )\n    }\n  }\n  \n  return(\n    <div\n      className='userOrTagFeed'\n    >\n\n      {handleLikesHeader()}\n\n      <PostLoading \n        uploading={uploading}\n      />\n      {feedArr.current.map((obj, i) => {\n        if (obj.kind === 'Repost') {\n          return (\n            <div\n              className={handlePostClassName(obj)}\n              key={obj._id}\n            >\n              \n              <div\n                className='userRepostShowHeader'\n              >\n                <ProfilePic\n                  user={obj.post.user}\n                />\n                <span\n                  className='repostHeaderContainer'\n                >\n                  <Link \n                    className='user'\n                    to={`/view/blog/${obj.user.blogName}`}>\n                    {obj.user.blogName}\n                  </Link>\n\n                  <div\n                    className='iconRepostedAndFollowContainer'\n                  >\n                    <img\n                      src=\"https://img.icons8.com/material-two-tone/24/ffffff/retweet.png\"\n                      alt=''\n                    />\n                    <Link\n                      className='repostedFrom'\n                      to={`/view/blog/${obj.repostedFrom.blogName}`}\n                    >\n                      {obj.user.blogName}\n                    </Link>\n                    <FollowButton\n                      feed={true}\n                      user={obj.repostedFrom}\n                    />\n                  </div>\n                </span>\n              </div>\n              \n              <PostUpdateOrShow\n                post={obj}\n                repostFormBool={false}\n                uploading={uploading}\n                setUploading={setUploading}\n              />\n            </div>\n          )\n        } else {\n          return (\n            <div\n              className={handlePostClassName(obj)}\n              key={obj._id}\n            >\n              <PostUpdateOrShow\n                post={obj}\n                currentUser={currentUser}\n                uploading={uploading}\n                setUploading={setUploading}\n              />\n            </div>\n          )\n        }\n      })}\n      <div\n        id='fetchMoreFeed'\n      >\n        {endOfPosts.current ? \"You're all caught up\" : \"\"}\n      </div>\n    </div>\n  )\n}\n\nexport default Feed;"]},"metadata":{},"sourceType":"module"}