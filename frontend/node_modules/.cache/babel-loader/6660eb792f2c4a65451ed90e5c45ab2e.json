{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/Users/johnobrien/Desktop/Rumblr_PROD/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\");\n\nvar _asyncToGenerator = require(\"/Users/johnobrien/Desktop/Rumblr_PROD/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nvar _classCallCheck = require(\"/Users/johnobrien/Desktop/Rumblr_PROD/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/johnobrien/Desktop/Rumblr_PROD/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar _inherits = require(\"/Users/johnobrien/Desktop/Rumblr_PROD/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/inherits\");\n\nvar _createSuper = require(\"/Users/johnobrien/Desktop/Rumblr_PROD/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createSuper\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ReadableWebToNodeStream = void 0;\n\nvar readable_stream_1 = require(\"readable-stream\");\n/**\n * Converts a Web-API stream into Node stream.Readable class\n * Node stream readable: https://nodejs.org/api/stream.html#stream_readable_streams\n * Web API readable-stream: https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream\n * Node readable stream: https://nodejs.org/api/stream.html#stream_readable_streams\n */\n\n\nvar ReadableWebToNodeStream = /*#__PURE__*/function (_readable_stream_1$Re) {\n  _inherits(ReadableWebToNodeStream, _readable_stream_1$Re);\n\n  var _super = _createSuper(ReadableWebToNodeStream);\n\n  /**\n   *\n   * @param stream Readable​Stream: https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream\n   */\n  function ReadableWebToNodeStream(stream) {\n    var _this;\n\n    _classCallCheck(this, ReadableWebToNodeStream);\n\n    _this = _super.call(this);\n    _this.bytesRead = 0;\n    _this.released = false;\n    _this.reader = stream.getReader();\n    return _this;\n  }\n  /**\n   * Implementation of readable._read(size).\n   * When readable._read() is called, if data is available from the resource,\n   * the implementation should begin pushing that data into the read queue\n   * https://nodejs.org/api/stream.html#stream_readable_read_size_1\n   */\n\n\n  _createClass(ReadableWebToNodeStream, [{\n    key: \"_read\",\n    value: function () {\n      var _read2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var data;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!this.released) {\n                  _context.next = 3;\n                  break;\n                }\n\n                this.push(null); // Signal EOF\n\n                return _context.abrupt(\"return\");\n\n              case 3:\n                this.pendingRead = this.reader.read();\n                _context.next = 6;\n                return this.pendingRead;\n\n              case 6:\n                data = _context.sent;\n                // clear the promise before pushing pushing new data to the queue and allow sequential calls to _read()\n                delete this.pendingRead;\n\n                if (data.done || this.released) {\n                  this.push(null); // Signal EOF\n                } else {\n                  this.bytesRead += data.value.length;\n                  this.push(data.value); // Push new data to the queue\n                }\n\n              case 9:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function _read() {\n        return _read2.apply(this, arguments);\n      }\n\n      return _read;\n    }()\n    /**\n     * If there is no unresolved read call to Web-API Readable​Stream immediately returns;\n     * otherwise will wait until the read is resolved.\n     */\n\n  }, {\n    key: \"waitForReadToComplete\",\n    value: function () {\n      var _waitForReadToComplete = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!this.pendingRead) {\n                  _context2.next = 3;\n                  break;\n                }\n\n                _context2.next = 3;\n                return this.pendingRead;\n\n              case 3:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function waitForReadToComplete() {\n        return _waitForReadToComplete.apply(this, arguments);\n      }\n\n      return waitForReadToComplete;\n    }()\n    /**\n     * Close wrapper\n     */\n\n  }, {\n    key: \"close\",\n    value: function () {\n      var _close = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return this.syncAndRelease();\n\n              case 2:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function close() {\n        return _close.apply(this, arguments);\n      }\n\n      return close;\n    }()\n  }, {\n    key: \"syncAndRelease\",\n    value: function () {\n      var _syncAndRelease = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                this.released = true;\n                _context4.next = 3;\n                return this.waitForReadToComplete();\n\n              case 3:\n                _context4.next = 5;\n                return this.reader.releaseLock();\n\n              case 5:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function syncAndRelease() {\n        return _syncAndRelease.apply(this, arguments);\n      }\n\n      return syncAndRelease;\n    }()\n  }]);\n\n  return ReadableWebToNodeStream;\n}(readable_stream_1.Readable);\n\nexports.ReadableWebToNodeStream = ReadableWebToNodeStream;","map":{"version":3,"sources":["/Users/johnobrien/Desktop/Rumblr_PROD/client/node_modules/readable-web-to-node-stream/lib/index.js"],"names":["Object","defineProperty","exports","value","ReadableWebToNodeStream","readable_stream_1","require","stream","bytesRead","released","reader","getReader","push","pendingRead","read","data","done","length","syncAndRelease","waitForReadToComplete","releaseLock","Readable"],"mappings":"AAAA;;;;;;;;;;;;;;AACAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;AACAD,OAAO,CAACE,uBAAR,GAAkC,KAAK,CAAvC;;AACA,IAAMC,iBAAiB,GAAGC,OAAO,CAAC,iBAAD,CAAjC;AACA;AACA;AACA;AACA;AACA;AACA;;;IACMF,uB;;;;;AACF;AACJ;AACA;AACA;AACI,mCAAYG,MAAZ,EAAoB;AAAA;;AAAA;;AAChB;AACA,UAAKC,SAAL,GAAiB,CAAjB;AACA,UAAKC,QAAL,GAAgB,KAAhB;AACA,UAAKC,MAAL,GAAcH,MAAM,CAACI,SAAP,EAAd;AAJgB;AAKnB;AACD;AACJ;AACA;AACA;AACA;AACA;;;;;;4EACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAGQ,KAAKF,QAHb;AAAA;AAAA;AAAA;;AAIQ,qBAAKG,IAAL,CAAU,IAAV,EAJR,CAIyB;;AAJzB;;AAAA;AAOI,qBAAKC,WAAL,GAAmB,KAAKH,MAAL,CAAYI,IAAZ,EAAnB;AAPJ;AAAA,uBAQuB,KAAKD,WAR5B;;AAAA;AAQUE,gBAAAA,IARV;AASI;AACA,uBAAO,KAAKF,WAAZ;;AACA,oBAAIE,IAAI,CAACC,IAAL,IAAa,KAAKP,QAAtB,EAAgC;AAC5B,uBAAKG,IAAL,CAAU,IAAV,EAD4B,CACX;AACpB,iBAFD,MAGK;AACD,uBAAKJ,SAAL,IAAkBO,IAAI,CAACZ,KAAL,CAAWc,MAA7B;AACA,uBAAKL,IAAL,CAAUG,IAAI,CAACZ,KAAf,EAFC,CAEsB;AAC1B;;AAjBL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,O;;;;;;;;AAmBA;AACJ;AACA;AACA;;;;;4FACI;AAAA;AAAA;AAAA;AAAA;AAAA,qBACQ,KAAKU,WADb;AAAA;AAAA;AAAA;;AAAA;AAAA,uBAEc,KAAKA,WAFnB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,O;;;;;;;;AAKA;AACJ;AACA;;;;;4EACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBACU,KAAKK,cAAL,EADV;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,O;;;;;;;;;;;qFAGA;AAAA;AAAA;AAAA;AAAA;AACI,qBAAKT,QAAL,GAAgB,IAAhB;AADJ;AAAA,uBAEU,KAAKU,qBAAL,EAFV;;AAAA;AAAA;AAAA,uBAGU,KAAKT,MAAL,CAAYU,WAAZ,EAHV;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,O;;;;;;;;;;;EAnDkCf,iBAAiB,CAACgB,Q;;AAyDxDnB,OAAO,CAACE,uBAAR,GAAkCA,uBAAlC","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ReadableWebToNodeStream = void 0;\nconst readable_stream_1 = require(\"readable-stream\");\n/**\n * Converts a Web-API stream into Node stream.Readable class\n * Node stream readable: https://nodejs.org/api/stream.html#stream_readable_streams\n * Web API readable-stream: https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream\n * Node readable stream: https://nodejs.org/api/stream.html#stream_readable_streams\n */\nclass ReadableWebToNodeStream extends readable_stream_1.Readable {\n    /**\n     *\n     * @param stream Readable​Stream: https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream\n     */\n    constructor(stream) {\n        super();\n        this.bytesRead = 0;\n        this.released = false;\n        this.reader = stream.getReader();\n    }\n    /**\n     * Implementation of readable._read(size).\n     * When readable._read() is called, if data is available from the resource,\n     * the implementation should begin pushing that data into the read queue\n     * https://nodejs.org/api/stream.html#stream_readable_read_size_1\n     */\n    async _read() {\n        // Should start pushing data into the queue\n        // Read data from the underlying Web-API-readable-stream\n        if (this.released) {\n            this.push(null); // Signal EOF\n            return;\n        }\n        this.pendingRead = this.reader.read();\n        const data = await this.pendingRead;\n        // clear the promise before pushing pushing new data to the queue and allow sequential calls to _read()\n        delete this.pendingRead;\n        if (data.done || this.released) {\n            this.push(null); // Signal EOF\n        }\n        else {\n            this.bytesRead += data.value.length;\n            this.push(data.value); // Push new data to the queue\n        }\n    }\n    /**\n     * If there is no unresolved read call to Web-API Readable​Stream immediately returns;\n     * otherwise will wait until the read is resolved.\n     */\n    async waitForReadToComplete() {\n        if (this.pendingRead) {\n            await this.pendingRead;\n        }\n    }\n    /**\n     * Close wrapper\n     */\n    async close() {\n        await this.syncAndRelease();\n    }\n    async syncAndRelease() {\n        this.released = true;\n        await this.waitForReadToComplete();\n        await this.reader.releaseLock();\n    }\n}\nexports.ReadableWebToNodeStream = ReadableWebToNodeStream;\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"script"}