{"ast":null,"code":"import _regeneratorRuntime from\"/Users/johnobrien/Desktop/Rumblr_PROD/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/johnobrien/Desktop/Rumblr_PROD/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/johnobrien/Desktop/Rumblr_PROD/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useRef,useEffect}from'react';import{useMutation}from'@apollo/client';import{useHistory}from'react-router-dom';import Cookies from'js-cookie';import randomstring from'randomstring';import VideoInput from'../../util/components/forms/inputTypes/Video_Input';import BodyImageAndText from'../../util/components/forms/Body_Image_And_Text';import Tags from'../../util/components/forms/Tags';import ProfilePic from'../../../user/util/components/Profile_Pic';import ConfirmClose from'../../../nav/Confirm_Close';import Queries from'../../../../graphql/queries.js';import Mutations from'../../../../graphql/mutations.js';import PostFormUtil from'../../util/functions/post_form_util.js';import UpdateCacheUtil from'../../util/functions/update_cache_util.js';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var postCreate=UpdateCacheUtil.postCreate,postUpdate=UpdateCacheUtil.postUpdate;var bodyPost=PostFormUtil.bodyPost,videoPost=PostFormUtil.videoPost,handleFormData=PostFormUtil.handleFormData,stripAllImgs=PostFormUtil.stripAllImgs,handleUploadedFiles=PostFormUtil.handleUploadedFiles,resetDisplayIdx=PostFormUtil.resetDisplayIdx,handleMentions=PostFormUtil.handleMentions,discardMentions=PostFormUtil.discardMentions,handleAllTextVideoPost=PostFormUtil.handleAllTextVideoPost,allowScroll=PostFormUtil.allowScroll,preventScroll=PostFormUtil.preventScroll,handleTagInput=PostFormUtil.handleTagInput;var CREATE_OR_UPDATE_POST=Mutations.CREATE_OR_UPDATE_POST;var FETCH_USER_FEED=Queries.FETCH_USER_FEED;var VideoPostForm=function VideoPostForm(_ref){var mobile=_ref.mobile,user=_ref.user,post=_ref.post,update=_ref.update,setUpdate=_ref.setUpdate,videoPostActive=_ref.videoPostActive,setVideoPostActive=_ref.setVideoPostActive,postFormModal=_ref.postFormModal,setPostFormModal=_ref.setPostFormModal,postFormOpen=_ref.postFormOpen,setPostFormOpen=_ref.setPostFormOpen,uploading=_ref.uploading,setUploading=_ref.setUploading;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),videoFile=_useState2[0],setVideoFile=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),videoObj=_useState4[0],setVideoObj=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isLink=_useState6[0],setIsLink=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),active=_useState8[0],setActive=_useState8[1];var objsToClean=useRef([]);var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),description=_useState10[0],setDescription=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),bodyImageFiles=_useState12[0],setBodyImageFiles=_useState12[1];var body=useRef([]);var allText=useRef('');var _useState13=useState(''),_useState14=_slicedToArray(_useState13,2),tag=_useState14[0],setTag=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),tags=_useState16[0],setTags=_useState16[1];var _useState17=useState(''),_useState18=_slicedToArray(_useState17,2),errMessage=_useState18[0],setErrMessage=_useState18[1];var _useState19=useState(0),_useState20=_slicedToArray(_useState19,2),render=_useState20[0],setRender=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),confirmClose=_useState22[0],setConfirmClose=_useState22[1];var _useState23=useState(false),_useState24=_slicedToArray(_useState23,2),displayBodyImageAndTextInput=_useState24[0],setDisplayBodyImageAndTextInput=_useState24[1];var history=useHistory();var formId='videoPostForm';var formInputId='videoPostInput';useEffect(function(){preventScroll(videoPostActive,document);},[videoPostActive]);useEffect(function(){resetDisplayIdx(body);});var _useMutation=useMutation(CREATE_OR_UPDATE_POST,{update:function update(client,_ref2){var data=_ref2.data;var createOrUpdatePost=data.createOrUpdatePost;var currentUser=Cookies.get('currentUser');var query=FETCH_USER_FEED;if(post){postUpdate(client,createOrUpdatePost,currentUser,query);}else{postCreate(client,createOrUpdatePost,currentUser,query);}},onCompleted:function onCompleted(){resetInputs();if(post){setUpdate(update=false);}else{resetInputs();allowScroll(document);setVideoPostActive(videoPostActive=false);if(mobile){setPostFormOpen(postFormOpen=false);history.push('/dashboard');}setUploading(uploading=false);}},onError:function onError(error){console.log(error);}}),_useMutation2=_slicedToArray(_useMutation,1),createOrUpdatePost=_useMutation2[0];var resetInputs=function resetInputs(){setVideoObj(videoObj='');setVideoFile(videoFile='');setActive(active=false);setUploading(uploading=false);setBodyImageFiles(bodyImageFiles=[]);body.current=[];allText.current='';setDescription(description='');setTag(tag='');setTags(tags=[]);setErrMessage(errMessage='');};var handleSubmit=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var videoFileFormData,bodyImagesFormData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();if(videoFile){videoFileFormData=new FormData();videoFileFormData.append('video',videoFile);}bodyImagesFormData=handleFormData(bodyImageFiles);Promise.all([bodyPost(bodyImagesFormData),videoPost(videoFileFormData,isLink,videoObj)]).then(function(_ref4){var _ref5=_slicedToArray(_ref4,2),bodyUploads=_ref5[0],video=_ref5[1];var mentions=handleMentions(body,stripAllImgs);discardMentions(post,mentions,objsToClean);var descriptions=stripAllImgs(body);handleAllTextVideoPost(allText,descriptions);var instanceData={variants:{videoLink:video[0]._id},allText:allText.current,descriptions:descriptions,descriptionImages:handleUploadedFiles(body,bodyUploads),mentions:mentions,user:Cookies.get('currentUser'),tags:tags,kind:'VideoPost',objsToClean:objsToClean.current,postId:post?post._id:null};createOrUpdatePost({variables:{instanceData:instanceData}});});case 4:case\"end\":return _context.stop();}}},_callee);}));return function handleSubmit(_x){return _ref3.apply(this,arguments);};}();var disabledBool=function disabledBool(){return!videoFile&&!videoObj&&!uploading&&body.current.length===0&&!description;};var handleVideoPostFormClass=function handleVideoPostFormClass(){if(videoPostActive&&!uploading||update){return'postForm videoPostForm active';}else if(videoPostActive&&uploading){return'postForm videoPostForm hidden';}else{return'postForm videoPostForm none';}};if(videoPostActive||update){return/*#__PURE__*/_jsxs(\"div\",{className:update?'postFormContainer update':'postFormContainer',children:[/*#__PURE__*/_jsx(ProfilePic,{user:update?post.user:user}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"div\",{className:handleVideoPostFormClass(),children:[/*#__PURE__*/_jsx(\"h3\",{className:\"userNameHeader\",children:update?post.user.blogName:user.blogName}),/*#__PURE__*/_jsxs(\"form\",{id:formId,onSubmit:function onSubmit(e){setUploading(uploading=true);handleSubmit(e);},onKeyPress:function onKeyPress(e){e.key==='Enter'&&e.preventDefault();},encType:'multipart/form-data',children:[/*#__PURE__*/_jsx(\"p\",{children:uploading?'Uploading, please wait...':''}),/*#__PURE__*/_jsx(VideoInput,{displayBodyImageAndTextInput:displayBodyImageAndTextInput,setDisplayBodyImageAndTextInput:setDisplayBodyImageAndTextInput,post:post,update:update,formId:formId,active:active,objsToClean:objsToClean,setActive:setActive,videoObj:videoObj,setVideoObj:setVideoObj,videoFile:videoFile,setVideoFile:setVideoFile,isLink:isLink,setIsLink:setIsLink}),/*#__PURE__*/_jsx(BodyImageAndText,{displayBodyImageAndTextInput:displayBodyImageAndTextInput,post:post,update:update,formId:formId,formInputId:formInputId,objsToClean:objsToClean,body:body,bodyImageFiles:bodyImageFiles,setBodyImageFiles:setBodyImageFiles,description:description,setDescription:setDescription,render:render,setRender:setRender,errMessage:errMessage,setErrMessage:setErrMessage}),/*#__PURE__*/_jsx(Tags,{post:post,tag:tag,setTag:setTag,tags:tags,setTags:setTags}),/*#__PURE__*/_jsxs(\"div\",{className:\"closeOrPostContainer\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"closeBtn\",onClick:function onClick(){if(disabledBool()){resetInputs();allowScroll(document);if(!update){setVideoPostActive(videoPostActive=false);setPostFormModal(postFormModal=false);}else{setUpdate(update=false);}if(mobile){setPostFormOpen(postFormOpen=false);}}else{setConfirmClose(confirmClose=true);}},children:\"Close\"}),/*#__PURE__*/_jsx(ConfirmClose,{mobile:mobile,update:update,setUpdate:setUpdate,confirmClose:confirmClose,setConfirmClose:setConfirmClose,allowScroll:allowScroll,resetInputs:resetInputs,setFormActive:setVideoPostActive,formActive:videoPostActive,setPostFormModal:setPostFormModal,postFormModal:postFormModal,postFormOpen:postFormOpen,setPostFormOpen:setPostFormOpen}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:disabledBool(),className:disabledBool()?'formSubmitBtn disabled':'formSubmitBtn',onClick:function onClick(){if(description){var textObj={kind:'text',srcType:'text',content:description,displayIdx:body.current.length,uniqId:randomstring.generate({length:12,charset:'alphabetic'})};body.current.push(textObj);setDescription(description='');}if(tag){handleTagInput(tag,setTag,tags,setTags);}if(!update){setPostFormModal(postFormModal=false);}setUploading(uploading=true);},children:post?'Update':'Post'})]})]})]})})]});}else{return/*#__PURE__*/_jsx(\"div\",{});}};export default VideoPostForm;","map":{"version":3,"sources":["/Users/johnobrien/Desktop/Rumblr_PROD/client/src/components/posts/types/create/VideoPostForm.js"],"names":["React","useState","useRef","useEffect","useMutation","useHistory","Cookies","randomstring","VideoInput","BodyImageAndText","Tags","ProfilePic","ConfirmClose","Queries","Mutations","PostFormUtil","UpdateCacheUtil","postCreate","postUpdate","bodyPost","videoPost","handleFormData","stripAllImgs","handleUploadedFiles","resetDisplayIdx","handleMentions","discardMentions","handleAllTextVideoPost","allowScroll","preventScroll","handleTagInput","CREATE_OR_UPDATE_POST","FETCH_USER_FEED","VideoPostForm","mobile","user","post","update","setUpdate","videoPostActive","setVideoPostActive","postFormModal","setPostFormModal","postFormOpen","setPostFormOpen","uploading","setUploading","videoFile","setVideoFile","videoObj","setVideoObj","isLink","setIsLink","active","setActive","objsToClean","description","setDescription","bodyImageFiles","setBodyImageFiles","body","allText","tag","setTag","tags","setTags","errMessage","setErrMessage","render","setRender","confirmClose","setConfirmClose","displayBodyImageAndTextInput","setDisplayBodyImageAndTextInput","history","formId","formInputId","document","client","data","createOrUpdatePost","currentUser","get","query","onCompleted","resetInputs","push","onError","error","console","log","current","handleSubmit","e","preventDefault","videoFileFormData","FormData","append","bodyImagesFormData","Promise","all","then","bodyUploads","video","mentions","descriptions","instanceData","variants","videoLink","_id","descriptionImages","kind","postId","variables","disabledBool","length","handleVideoPostFormClass","blogName","key","textObj","srcType","content","displayIdx","uniqId","generate","charset"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport { useMutation } from '@apollo/client';\nimport { useHistory } from 'react-router-dom';\nimport Cookies from 'js-cookie';\nimport randomstring from 'randomstring';\n\nimport VideoInput from '../../util/components/forms/inputTypes/Video_Input';\nimport BodyImageAndText from '../../util/components/forms/Body_Image_And_Text';\nimport Tags from '../../util/components/forms/Tags';\nimport ProfilePic from '../../../user/util/components/Profile_Pic';\nimport ConfirmClose from '../../../nav/Confirm_Close';\n\nimport Queries from '../../../../graphql/queries.js';\nimport Mutations from '../../../../graphql/mutations.js';\nimport PostFormUtil from '../../util/functions/post_form_util.js';\nimport UpdateCacheUtil from '../../util/functions/update_cache_util.js';\nconst { postCreate, postUpdate } = UpdateCacheUtil;\nconst { bodyPost, videoPost, handleFormData, \n        stripAllImgs, handleUploadedFiles, \n        resetDisplayIdx, handleMentions, \n        discardMentions, handleAllTextVideoPost,\n        allowScroll, preventScroll, handleTagInput  } = PostFormUtil;\nconst { CREATE_OR_UPDATE_POST } = Mutations;\nconst { FETCH_USER_FEED } = Queries;\n\nconst VideoPostForm = ({\n  mobile,\n  user,\n  post, \n  update,\n  setUpdate,\n  videoPostActive,\n  setVideoPostActive,\n  postFormModal,\n  setPostFormModal,\n  postFormOpen,\n  setPostFormOpen,\n  uploading,\n  setUploading\n}) => {\n  let [videoFile, setVideoFile] = useState('');\n  let [videoObj, setVideoObj] = useState('');\n  let [isLink, setIsLink] = useState(false)\n  \n  let [active, setActive] = useState(false)\n  let objsToClean = useRef([]);\n  let [description, setDescription] = useState('');\n  let [bodyImageFiles, setBodyImageFiles] = useState([]);\n  let body = useRef([]);\n  let allText = useRef('');\n  let [tag, setTag] = useState('');\n  let [tags, setTags] = useState([]);\n  let [errMessage, setErrMessage] = useState('');\n  let [render, setRender] = useState(0);\n  let [confirmClose, setConfirmClose] = useState(false);\n  let [displayBodyImageAndTextInput, setDisplayBodyImageAndTextInput] = useState(false);\n  let history = useHistory();\n  const formId = 'videoPostForm';\n  const formInputId = 'videoPostInput'\n\n  useEffect(() => {\n\n    preventScroll(videoPostActive, document)\n\n  }, [videoPostActive])\n\n  useEffect(() => {\n    resetDisplayIdx(body)\n  })\n\n  let [createOrUpdatePost] = useMutation(CREATE_OR_UPDATE_POST, {\n    update(client, { data }){\n      const { createOrUpdatePost } = data;\n      var currentUser = Cookies.get('currentUser')\n      var query = FETCH_USER_FEED\n      \n      if (post) {\n        postUpdate(client, createOrUpdatePost, currentUser, query)\n      } else {\n        postCreate(client, createOrUpdatePost, currentUser, query)\n      }\n    },\n    onCompleted() {\n      resetInputs();\n      if (post) {\n        setUpdate(update = false)\n      } else {\n        resetInputs()\n        allowScroll(document)\n        setVideoPostActive(videoPostActive = false)\n        \n        if (mobile) {\n          setPostFormOpen(postFormOpen = false)\n          history.push('/dashboard')\n        }\n\n        setUploading(uploading = false)\n      }\n    },\n    onError(error) {\n      console.log(error)\n    }\n  });\n\n  const resetInputs = () => {\n    setVideoObj(videoObj = '');\n    setVideoFile(videoFile = '');\n    setActive(active = false);\n    setUploading(uploading = false);\n    setBodyImageFiles(bodyImageFiles = []);\n    body.current = [];\n    allText.current = '';\n    setDescription(description = '');\n    setTag(tag = '');\n    setTags(tags = []);\n    setErrMessage(errMessage = '');\n  }\n  \n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    \n    if (videoFile) {\n      var videoFileFormData = new FormData();\n      videoFileFormData.append('video', videoFile)\n    }\n\n    var bodyImagesFormData = handleFormData(bodyImageFiles)\n\n    Promise.all([\n      bodyPost(bodyImagesFormData),\n      videoPost(videoFileFormData, isLink, videoObj)\n    ]).then(\n      ([bodyUploads, video]) => {\n\n        var mentions = handleMentions(body, stripAllImgs)\n        \n        discardMentions(post, mentions, objsToClean)\n\n        var descriptions = stripAllImgs(body)\n\n        handleAllTextVideoPost(allText, descriptions)\n\n        var instanceData = {\n          variants: {\n            videoLink: video[0]._id\n          },\n          allText: allText.current,\n          descriptions: descriptions,\n          descriptionImages: handleUploadedFiles(body, bodyUploads),\n          mentions: mentions,\n          user: Cookies.get('currentUser'),\n          tags, kind: 'VideoPost',\n          objsToClean: objsToClean.current,\n          postId: post ? post._id : null\n        };\n        \n        createOrUpdatePost({\n          variables: {\n            instanceData: instanceData\n          }\n        })\n      }\n    )\n  }\n\n  const disabledBool = () => {\n    return !videoFile && \n    !videoObj &&\n    !uploading &&\n    body.current.length === 0 &&\n    !description\n  }\n\n  const handleVideoPostFormClass = () => {\n    if ((videoPostActive && !uploading) || update) {\n      return 'postForm videoPostForm active'\n    } else if (videoPostActive && uploading) {\n      return 'postForm videoPostForm hidden'\n    } else {\n      return 'postForm videoPostForm none'\n    }\n  }\n\n  if (videoPostActive || update) {\n    return (\n    <div\n      className={update ? 'postFormContainer update' : 'postFormContainer'}\n    >\n\n      <ProfilePic user={update ? post.user : user} />\n\n      <div>\n        <div\n          className={handleVideoPostFormClass()}\n        >\n          \n          <h3\n            className='userNameHeader'\n          >{update ? post.user.blogName : user.blogName}</h3>\n\n          <form\n            id={formId}\n            onSubmit={e => {\n              setUploading(uploading = true)\n              handleSubmit(e)\n            }}\n            onKeyPress={e => { e.key === 'Enter' && e.preventDefault() }}\n            encType={'multipart/form-data'}\n          >\n\n          <p>{uploading ? 'Uploading, please wait...': ''}</p>\n          \n          <VideoInput\n            displayBodyImageAndTextInput={displayBodyImageAndTextInput}\n            setDisplayBodyImageAndTextInput={setDisplayBodyImageAndTextInput}\n            post={post}\n            update={update}\n            formId={formId}\n            active={active}\n            objsToClean={objsToClean}\n            setActive={setActive}\n            videoObj={videoObj}\n            setVideoObj={setVideoObj}\n            videoFile={videoFile}\n            setVideoFile={setVideoFile}\n            isLink={isLink}\n            setIsLink={setIsLink}\n          />\n\n          <BodyImageAndText\n            displayBodyImageAndTextInput={displayBodyImageAndTextInput}\n            post={post}\n            update={update}\n            formId={formId}\n            formInputId={formInputId}\n            objsToClean={objsToClean}\n            body={body}\n            bodyImageFiles={bodyImageFiles}\n            setBodyImageFiles={setBodyImageFiles}\n            description={description}\n            setDescription={setDescription}\n            render={render}\n            setRender={setRender}\n            errMessage={errMessage}\n            setErrMessage={setErrMessage}\n          />\n\n          <Tags\n            post={post}\n            tag={tag}\n            setTag={setTag}\n            tags={tags}\n            setTags={setTags}\n          />\n\n          <div\n            className='closeOrPostContainer'\n          >\n            <div\n              className='closeBtn'\n              onClick={() => {\n                if (disabledBool()) {\n                    resetInputs()\n                    allowScroll(document)\n                    \n                    if (!update) {\n                      setVideoPostActive(videoPostActive = false)\n                      setPostFormModal(postFormModal = false)\n                    } else {\n                      setUpdate(update = false)\n                    }\n\n                    if (mobile) {\n                      setPostFormOpen(postFormOpen = false)\n                    }\n                  } else {\n                    setConfirmClose(confirmClose = true)\n                  }\n              }}\n            >\n              Close\n            </div>\n\n            <ConfirmClose\n              mobile={mobile}\n              update={update}\n              setUpdate={setUpdate}\n              confirmClose={confirmClose}\n              setConfirmClose={setConfirmClose}\n              allowScroll={allowScroll}\n              resetInputs={resetInputs}\n              setFormActive={setVideoPostActive}\n              formActive={videoPostActive}\n              setPostFormModal={setPostFormModal}\n              postFormModal={postFormModal}\n              postFormOpen={postFormOpen}\n              setPostFormOpen={setPostFormOpen}\n            />\n\n            <button\n              type='submit'\n              disabled={disabledBool()}\n              className={disabledBool() ? 'formSubmitBtn disabled' : 'formSubmitBtn'}\n              onClick={() => {\n                if (description) {\n                  var textObj = {\n                    kind: 'text',\n                    srcType: 'text',\n                    content: description,\n                    displayIdx: body.current.length,\n                    uniqId: randomstring.generate({\n                      length: 12,\n                      charset: 'alphabetic'\n                    })\n                  }\n  \n                  body.current.push(textObj)\n                \n                  setDescription(description = '')\n                }\n                \n                if (tag) {\n                  handleTagInput(\n                    tag, setTag,\n                    tags, setTags\n                  )\n                }\n                \n                if (!update) {\n                  setPostFormModal(postFormModal = false)\n                }\n\n                setUploading(uploading = true)\n              }}\n            >\n              {post ? 'Update' : 'Post'}\n            </button>\n          </div>\n          </form>\n        </div>\n      </div>\n    </div>\n    )\n  } else {\n    return (\n      <div>\n      </div>\n    )\n  }\n}\n\nexport default VideoPostForm;"]},"metadata":{},"sourceType":"module"}