{"ast":null,"code":"import _slicedToArray from\"/Users/johnobrien/Desktop/Rumblr_PROD/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useRef,useEffect}from'react';import{useMutation}from'@apollo/client';import Cookies from'js-cookie';import PhotoPostOrRegisterPhotoInput from'../../../posts/util/components/forms/inputTypes/Photo_Post_Or_Register_Photo_Input';import Queries from'../../../../graphql/queries';import Mutations from'../../../../graphql/mutations.js';import PostFormUtil from'../../../posts/util/functions/post_form_util.js';import UserSettingsUtil from'../functions/user_settings_util.js';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var handleFormData=PostFormUtil.handleFormData,mainPost=PostFormUtil.mainPost;var UPDATE_PROFILE_PIC=Mutations.UPDATE_PROFILE_PIC;var FETCH_USER=Queries.FETCH_USER;var updateCacheUpdateProfilePic=UserSettingsUtil.updateCacheUpdateProfilePic;var EditProfilePic=function EditProfilePic(_ref){var user=_ref.user;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),active=_useState2[0],setActive=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),profileImageFile=_useState4[0],setProfileImageFile=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),password=_useState6[0],setPassword=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),errorMessage=_useState8[0],setErrorMessage=_useState8[1];var _useState9=useState(0),_useState10=_slicedToArray(_useState9,2),render=_useState10[0],setRender=_useState10[1];var previewProfilePicRef=useRef({});var iconUrls={user:user.profilePic?user.profilePic.src:null,default:\"https://img.icons8.com/dusk/64/000000/kawaii-ice-cream.png\"};useEffect(function(){if(iconUrls.user){previewProfilePicRef.current.src=iconUrls.user;previewProfilePicRef.current.alt='';}else{previewProfilePicRef.current.src=iconUrls.default;previewProfilePicRef.current.alt='';}},[iconUrls.user,iconUrls.default]);var _useMutation=useMutation(UPDATE_PROFILE_PIC,{update:function update(client,_ref2){var data=_ref2.data;var updateProfilePic=data.updateProfilePic;var currentUser=Cookies.get('currentUser');var query=FETCH_USER;updateCacheUpdateProfilePic(client,updateProfilePic,currentUser,query);},onCompleted:function onCompleted(data){resetInputs();setActive(active=false);},onError:function onError(error){setErrorMessage(errorMessage=\"mutation error: \".concat(error.message));}}),_useMutation2=_slicedToArray(_useMutation,1),updateProfilePic=_useMutation2[0];var resetInputs=function resetInputs(){previewProfilePicRef.current={};setProfileImageFile(profileImageFile=null);setErrorMessage(errorMessage='');setPassword(password='');};var handleSubmit=function handleSubmit(e){e.preventDefault();if(profileImageFile){var profileImageFormData=handleFormData(profileImageFile);}Promise.all([mainPost(profileImageFormData)]).then(function(_ref3){var _ref4=_slicedToArray(_ref3,1),mainUpload=_ref4[0];var instanceData={profilePicId:mainUpload.length>0?mainUpload[0]._id:null,password:password,user:Cookies.get('currentUser')};updateProfilePic({variables:{instanceData:instanceData}});});};if(active){return/*#__PURE__*/_jsxs(\"form\",{className:\"upload\",onSubmit:function onSubmit(e){if(profileImageFile&&password){handleSubmit(e);}else{setErrorMessage(errorMessage='Please confirm your password');}},children:[/*#__PURE__*/_jsx(PhotoPostOrRegisterPhotoInput,{register:true,edit:true,user:user,previewProfilePicRef:previewProfilePicRef,profileImageFile:profileImageFile,setProfileImageFile:setProfileImageFile,render:render,setRender:setRender}),/*#__PURE__*/_jsx(\"p\",{className:\"errMessage\",children:errorMessage?\"\".concat(errorMessage):''}),/*#__PURE__*/_jsxs(\"div\",{className:\"inputAndBtnContainer\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"password\",placeholder:\"Confirm password\",value:password,onChange:function onChange(e){setPassword(password=e.target.value);}}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{className:\"cancel\",type:\"button\",onClick:function onClick(){resetInputs();setActive(active=false);},children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{className:\"save\",type:\"submit\",children:\"Save\"})]})]})]});}else{return/*#__PURE__*/_jsxs(\"div\",{className:\"currentProPic settingContainer\",children:[/*#__PURE__*/_jsx(\"img\",{className:\"profilePic\",src:iconUrls.user?iconUrls.user:iconUrls.default,alt:\"\"}),/*#__PURE__*/_jsx(\"img\",{className:\"editPostBtn\",src:\"https://img.icons8.com/windows/64/000000/edit--v1.png\",alt:\"\",onClick:function onClick(){setActive(active=true);}})]});}};export default EditProfilePic;","map":{"version":3,"sources":["/Users/johnobrien/Desktop/Rumblr_PROD/client/src/components/user/util/components/Edit_Profile_Pic.js"],"names":["React","useState","useRef","useEffect","useMutation","Cookies","PhotoPostOrRegisterPhotoInput","Queries","Mutations","PostFormUtil","UserSettingsUtil","handleFormData","mainPost","UPDATE_PROFILE_PIC","FETCH_USER","updateCacheUpdateProfilePic","EditProfilePic","user","active","setActive","profileImageFile","setProfileImageFile","password","setPassword","errorMessage","setErrorMessage","render","setRender","previewProfilePicRef","iconUrls","profilePic","src","default","current","alt","update","client","data","updateProfilePic","currentUser","get","query","onCompleted","resetInputs","onError","error","message","handleSubmit","e","preventDefault","profileImageFormData","Promise","all","then","mainUpload","instanceData","profilePicId","length","_id","variables","target","value"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport { useMutation } from '@apollo/client';\nimport Cookies from 'js-cookie';\n\nimport PhotoPostOrRegisterPhotoInput from '../../../posts/util/components/forms/inputTypes/Photo_Post_Or_Register_Photo_Input';\n\nimport Queries from '../../../../graphql/queries';\nimport Mutations from '../../../../graphql/mutations.js';\nimport PostFormUtil from '../../../posts/util/functions/post_form_util.js';\nimport UserSettingsUtil from '../functions/user_settings_util.js'\nconst { handleFormData, mainPost } = PostFormUtil;\nconst { UPDATE_PROFILE_PIC } = Mutations;\nconst { FETCH_USER } = Queries;\nconst { updateCacheUpdateProfilePic } = UserSettingsUtil;\n\nconst EditProfilePic = ({\n  user\n}) => {\n  let [active, setActive] = useState(false);\n  let [profileImageFile, setProfileImageFile] = useState(null);\n  let [password, setPassword] = useState('');\n  let [errorMessage, setErrorMessage] = useState('');\n  let [render, setRender] = useState(0);\n  let previewProfilePicRef = useRef({});\n  \n  let iconUrls = {\n    user: user.profilePic ? user.profilePic.src : null,\n    default: \"https://img.icons8.com/dusk/64/000000/kawaii-ice-cream.png\"\n  }\n\n  useEffect(() => {\n    if (iconUrls.user) {\n      previewProfilePicRef.current.src = iconUrls.user\n      previewProfilePicRef.current.alt = ''\n    } else {\n      previewProfilePicRef.current.src = iconUrls.default\n      previewProfilePicRef.current.alt = ''\n    }\n  }, [iconUrls.user, iconUrls.default])\n\n  let [updateProfilePic] = useMutation(UPDATE_PROFILE_PIC, {\n    update(client, { data }) {\n      const { updateProfilePic } = data;\n      var currentUser = Cookies.get('currentUser')\n      var query = FETCH_USER\n      \n      updateCacheUpdateProfilePic(client, updateProfilePic, currentUser, query)\n    },\n    onCompleted(data) {\n      resetInputs()\n      setActive(active = false)\n    },\n    onError(error) {\n      setErrorMessage(errorMessage = `mutation error: ${error.message}`)\n    }\n  })\n  \n  const resetInputs = () => {\n    previewProfilePicRef.current = {}\n    setProfileImageFile(profileImageFile = null)\n    setErrorMessage(errorMessage = '')\n    setPassword(password = '')\n  }\n\n  const handleSubmit = (e) => {\n    e.preventDefault()\n\n    if (profileImageFile) {\n      var profileImageFormData = handleFormData(profileImageFile)\n    }\n\n    Promise.all([\n      mainPost(profileImageFormData)\n    ])\n    .then(([mainUpload]) => {\n      \n      var instanceData = {\n        profilePicId: mainUpload.length > 0 ? mainUpload[0]._id : null,\n        password: password,\n        user: Cookies.get('currentUser')\n      }\n\n      updateProfilePic({\n        variables: {\n          instanceData: instanceData\n        }\n      })\n    })\n  }\n\n  if (active) {\n    return (\n      <form\n        className='upload'\n        onSubmit={e => {\n          if (profileImageFile && password) {\n            handleSubmit(e)\n          } else {\n            setErrorMessage(errorMessage = 'Please confirm your password')\n          }\n        }}\n      >\n        <PhotoPostOrRegisterPhotoInput\n          register={true}\n          edit={true}\n          user={user}\n          previewProfilePicRef={previewProfilePicRef}\n          profileImageFile={profileImageFile}\n          setProfileImageFile={setProfileImageFile}\n          render={render}\n          setRender={setRender}\n        />\n\n        <p\n          className='errMessage'\n        >{errorMessage ? `${errorMessage}` : ''}</p>\n\n        <div\n          className='inputAndBtnContainer'\n        >\n          <input\n            type='password'\n            placeholder='Confirm password'\n            value={password}\n            onChange={e => {\n              setPassword(password = e.target.value)\n            }}\n          />\n\n          <div>\n            <button\n              className='cancel'\n              type='button'\n              onClick={() => {\n                resetInputs()\n                setActive(active = false)\n              }}\n            >\n              Cancel\n            </button>\n            <button\n              className='save'\n              type='submit'\n            >\n              Save\n            </button>\n          </div>\n        </div>\n      </form>\n    )\n  } else {\n    return (\n      <div\n        className='currentProPic settingContainer'\n      >\n        <img\n          className='profilePic'\n          src={iconUrls.user ? iconUrls.user : iconUrls.default}\n          alt=''\n        />\n        <img\n          className='editPostBtn'\n          src=\"https://img.icons8.com/windows/64/000000/edit--v1.png\"\n          alt=''\n          onClick={() => {\n            setActive(active = true)\n          }}\n        />\n      </div>\n    )\n  }\n}\n\n\nexport default EditProfilePic;"]},"metadata":{},"sourceType":"module"}